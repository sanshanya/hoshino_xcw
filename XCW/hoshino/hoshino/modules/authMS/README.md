# authMS

适用于HoshinoBot v2的授权插件, 大部分功能以天枢授权为蓝本而开发。本插件另有带有web服务的页面, 如果需要请在目录下新建vue目录,并下载相关链接中已编译好的文件放入(可能由于版本问题会有不兼容). 本项目主体框架由[wdvxdr1123](https://github.com/wdvxdr1123)构建, 火龙|PurinBot添加了一些重要功能. 

相关链接：
本项目地址：https://github.com/pcrbot/authMS

HoshinoBot项目地址：https://github.com/Ice-Cirno/HoshinoBot

编译好的vue：https://github.com/wdvxdr1123/pcr-auth-vue

## 特点
* **无GUI** ,不依赖Native环境, 依托于nonebot架构, 对不同的操作系统友好
* 支持新群试用
* 支持自定义到期后是否自动退群
* 支持无卡密操作, 直接对一个群的授权进行修改/清零, 同时执行自动退群(可选)
* 支持自定义入群发言, 退群发言
* 授权检查范围广, 支持以下情形:
  * 被拉近50人以下的群(因为默认不需要被邀请者同意)
  * 超过50人群, 需要机器人同意的群
  * 机器人掉线期间被邀请加入的群
  * 维护者手动登录机器人帐号加入的群
  
  以上情况加入的群聊, 均会收到授权系统的自动检测, 并可自定义退群或开启试用等操作。
  
## 指令示例
### 仅限超级管理员私聊的指令
* 生成卡密 31*5：生成5张31天的卡密, 仅限超级管理员私聊
* 卡密列表：查看已有卡密的信息,后跟数字来查看对应页数，仅限超级管理员私聊
* 授权列表：查看所有授权群的信息,后跟数字来查看对应页数，仅限超级管理员私聊

### 仅限超级管理员的指令
* 变更授权 123456789+5：为群123456789增加5天授权，也可以是减，仅限超级管理员
* 转移授权 123456*987654：将群123456的剩余时间转移至群987654，仅限超级管理员
* 授权状态：查询此机器人授权信息的统计，仅限超级管理员
* 清除授权 987654：清除群987654的全部授权，并自动退群（如果配置了的话），仅限超级管理员
* 退群 987654：命令退出群聊987654，但并不清除剩余授权时间，仅限超级管理员

### 通用指令
* 检验卡密 abcdefghijklemop：检查卡密的有效性
* 充值 abcdefghijklemop：群聊使用，为本群充值
* 充值 abcdefghijklemop*123456789：为群123456789充值

## 开始使用

1. 安装依赖, 如下载过慢建议清华镜像：
   ```
   pip install -r requirements.txt
   ```
2. 在HoshinoBot的module目录下克隆本项目:
   ```
   git clone https://github.com/pcrbot/authMS.git
   ```
3. 以`msghandle.py.example`替换`msghandle.py`文件, 请注意重命名：
4. 在HoshinoBot统一配置目录下保存配置信息,命名为`authMS.py`, 已提供配置样板`authMS.py.exaplme`, 按照注释修改为您需要的配置


## 其他
* 支持本机多个机器人数据互通, 详情参考`authMS.py.exaplme`中的注释, 由于SQLite是一个本地化的数据库,似乎不支持网络, 此部分均未测试, 出现问题请提交issue, 
* 其他问题可以在群内@我或[tg联系](https://t.me/Sun_Xiao_Chuan)我, 回复可能不及时
## 鸣谢
[GitHub@wdvxdr1123](https://github.com/wdvxdr1123)

火龙 | PurinBot

## 更新日志
### v0.1.0
更新时间:2020/8/15
* 初版发布